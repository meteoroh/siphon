{% for performer in performers %}
<tr>
    <td class="ps-4 py-3">
        <div class="d-flex flex-column">
            <a href="/performers/{{ performer.id }}" class="text-decoration-none fw-bold text-body mb-0">
                {{ performer.name }}
            </a>
            <small class="text-muted text-xs">{{ performer.id }}</small>
        </div>
    </td>
    <td>
        <span
            class="badge rounded-pill {{ 'bg-warning-subtle text-warning-emphasis' if performer.site == 'pornhub' else 'bg-danger-subtle text-danger-emphasis' }} border border-0">
            {{ performer.site }}
        </span>
    </td>
    <td>
        <span class="badge bg-secondary-subtle text-secondary-emphasis border border-0 rounded-pill">{{
            performer.type }}</span>
    </td>
    <td>
        <div id="performer-stats-{{ performer.id }}">
            {% set new_count = performer.videos.filter_by(status='new').count() %}
            {% if new_count > 0 %}
            <span class="badge bg-success-subtle text-success-emphasis rounded-pill border border-0">{{
                new_count }} New</span>
            {% else %}
            <span class="text-muted small ms-2">-</span>
            {% endif %}
        </div>
    </td>
    <td>
        <span class="text-secondary text-xs font-weight-bold">
            {{ performer.last_scan.strftime('%Y-%m-%d') if performer.last_scan else 'Never' }}
        </span>
    </td>
    <td class="text-center">
        {% if performer.scheduled_scan_enabled %}
        <i class="bi bi-check-circle-fill text-success" title="Enabled"></i>
        {% else %}
        <i class="bi bi-dash-circle text-muted opacity-50" title="Disabled"></i>
        {% endif %}
    </td>
    <td class="text-end pe-4">
        <div class="d-flex gap-2 justify-content-end">
            <button class="btn btn-sm btn-outline-primary" hx-post="/scan/{{ performer.id }}"
                hx-target="#performer-stats-{{ performer.id }}" hx-swap="innerHTML" title="Scan Now">
                <i class="bi bi-arrow-repeat"></i>
            </button>
            <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal"
                data-bs-target="#editPerformerModal{{ performer.id }}" title="Edit">
                <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" hx-delete="/performers/{{ performer.id }}/delete"
                hx-confirm="Are you sure you want to delete {{ performer.name }}?" hx-target="closest tr"
                hx-swap="outerHTML" title="Delete">
                <i class="bi bi-trash"></i>
            </button>
        </div>

        <!-- Edit Performer Modal -->
        <div class="modal fade text-start" id="editPerformerModal{{ performer.id }}" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0">
                    <div class="modal-header border-0 pb-0">
                        <h5 class="modal-title fw-bold">Edit Performer</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body pt-4">
                        <form hx-post="/performers/{{ performer.id }}/edit" hx-swap="none"
                            onsubmit="bootstrap.Modal.getInstance(document.getElementById('editPerformerModal{{ performer.id }}')).hide(); setTimeout(() => location.reload(), 500);">
                            <div class="mb-3">
                                <label class="form-label text-xs text-uppercase text-muted fw-bold">Name</label>
                                <input type="text" class="form-control" name="name" value="{{ performer.name }}"
                                    required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-xs text-uppercase text-muted fw-bold">Site</label>
                                <select class="form-select" name="site">
                                    <option value="pornhub" {% if performer.site=='pornhub' %}selected{% endif %}>
                                        Pornhub</option>
                                    <option value="xhamster" {% if performer.site=='xhamster' %}selected{% endif %}>
                                        xHamster</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="form-label text-xs text-uppercase text-muted fw-bold">Type</label>
                                <select class="form-select" name="type">
                                    <option value="model" {% if performer.type=='model' %}selected{% endif %}>Model
                                    </option>
                                    <option value="pornstar" {% if performer.type=='pornstar' %}selected{% endif %}>
                                        Pornstar</option>
                                    <option value="creator" {% if performer.type=='creator' %}selected{% endif %}>
                                        Creator</option>
                                </select>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </td>
</tr>
{% else %}
<tr>
    <td colspan="7" class="text-center py-5 text-muted">
        <div class="mb-3">
            <i class="bi bi-people display-4 opacity-25"></i>
        </div>
        <p class="mb-0">No performers found.</p>
        <small>Click "Add Performer" to get started.</small>
    </td>
</tr>
{% endfor %}