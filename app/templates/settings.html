{% extends "base.html" %}

{% block content %}
<h1>Settings</h1>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                Global Blacklist
            </div>
            <div class="card-body">
                <p class="text-muted">Comma-separated keywords to exclude from all downloads.</p>
                <form hx-post="/settings/blacklist" hx-target="#blacklist-message" hx-swap="innerHTML">
                    <div class="mb-3">
                        <textarea class="form-control" name="blacklist" rows="5">{{ blacklist }}</textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Blacklist</button>
                    <div id="blacklist-message"></div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                Global Whitelist
            </div>
            <div class="card-body">
                <p class="text-muted">Comma-separated keywords. If set, ONLY videos matching these will be downloaded
                    (unless overridden by performer settings).</p>
                <form hx-post="/settings/whitelist" hx-target="#whitelist-message" hx-swap="innerHTML">
                    <div class="mb-3">
                        <textarea class="form-control" name="whitelist" rows="5">{{ whitelist }}</textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Whitelist</button>
                    <div id="whitelist-message"></div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                Stash Integration
            </div>
            <div class="card-body">
                <form hx-post="/settings/stash" hx-target="#stash-message" hx-swap="innerHTML">
                    <div class="mb-3">
                        <label class="form-label">Stash URL (GraphQL Endpoint)</label>
                        <input type="text" class="form-control" name="stash_url" value="{{ stash_url }}"
                            placeholder="http://localhost:9999/graphql">
                    </div>
                    <div class="mb-3">
                        <label for="stash_api_key" class="form-label">Stash API Key</label>
                        <input type="password" class="form-control" id="stash_api_key" name="stash_api_key"
                            value="{{ stash_api_key }}">
                    </div>
                    <div class="mb-3">
                        <label for="stash_path_mapping" class="form-label">Path Mapping (Optional)</label>
                        <input type="text" class="form-control" id="stash_path_mapping" name="stash_path_mapping"
                            value="{{ stash_path_mapping }}" placeholder="/Volumes/media=/mnt/media">
                        <div class="form-text">Format: <code>LocalPath=RemotePath</code>. Maps local file paths to Stash
                            server paths.</div>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="stash_check_existing"
                            name="stash_check_existing" {% if stash_check_existing=='true' %}checked{% endif %}>
                        <label class="form-check-label" for="stash_check_existing">Check for existing videos in Stash
                            during scan</label>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Stash Settings</button>
                    <button class="btn btn-secondary" hx-post="/settings/stash/test" hx-target="#stash-message"
                        hx-swap="innerHTML">Test
                        Connection</button>
                    <div id="stash-message"></div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                Local Video Directory
            </div>
            <div class="card-body">
                <form hx-post="/settings/localpath" hx-target="#localpath-message" hx-swap="innerHTML">
                    <div class="mb-3">
                        <label class="form-label">Local Video Directory</label>
                        <input type="text" class="form-control" name="local_scan_path" value="{{ local_scan_path }}"
                            placeholder="/path/to/videos">
                        <div class="form-text">Directory for downloads. Also used to scan for existing videos if
                            <strong>"Check for existing videos"</strong> is enabled below.</div>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="local_check_existing"
                            name="local_check_existing" {% if local_check_existing=='true' %}checked{% endif %}>
                        <label class="form-check-label" for="local_check_existing">Check for existing videos in Local
                            Path during scan</label>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Local Path</button>
                    <div id="localpath-message"></div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                Scheduled Scraping
            </div>
            <div class="card-body">
                <form hx-post="/settings/schedule" hx-target="#schedule-message" hx-swap="innerHTML">
                    <div class="mb-3">
                        <label class="form-label">Interval (minutes)</label>
                        <input type="number" class="form-control" name="schedule_interval"
                            value="{{ schedule_interval }}" placeholder="60">
                        <div class="form-text">Set to 0 to disable automatic scraping.</div>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Schedule</button>
                    <div id="schedule-message"></div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                System Settings
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label">yt-dlp Update</label>
                    <div class="form-text">
                        Current Version: <strong>{{ yt_dlp_version }}</strong><br>
                        Last Updated: <strong>{{ yt_dlp_last_updated }}</strong>
                    </div>
                </div>
                <button class="btn btn-warning" hx-post="/settings/update-ytdlp" hx-swap="innerHTML"
                    hx-target="#ytdlp-message">
                    Update yt-dlp Now
                </button>
                <div id="ytdlp-message" class="mt-2"></div>

                <hr>

                <form hx-post="/settings/autoupdate" hx-target="#autoupdate-message" hx-swap="innerHTML">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="yt_dlp_auto_update" id="autoUpdateCheck"
                            {% if yt_dlp_auto_update=='true' %}checked{% endif %}>
                        <label class="form-check-label" for="autoUpdateCheck">Auto-update yt-dlp (Daily)</label>
                    </div>
                    <button type="submit" class="btn btn-primary mt-2">Save Auto-Update Setting</button>
                    <div id="autoupdate-message"></div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                Telegram Notification
            </div>
            <div class="card-body">
                <form hx-post="/settings/telegram" hx-target="#telegram-message" hx-swap="innerHTML">
                    <div class="mb-3">
                        <label class="form-label">Bot Token</label>
                        <input type="text" class="form-control" name="telegram_token" value="{{ telegram_token }}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Chat ID</label>
                        <input type="text" class="form-control" name="telegram_chat_id" value="{{ telegram_chat_id }}">
                    </div>
                    <button type="submit" class="btn btn-primary">Save Telegram Settings</button>
                    <button class="btn btn-secondary" hx-post="/settings/telegram/test" hx-target="#telegram-message"
                        hx-swap="innerHTML">Test
                        Notification</button>
                    <div id="telegram-message"></div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}